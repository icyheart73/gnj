var ColumnView,BaseElementView=require("elementor-elements/views/base"),ColumnEmptyView=require("elementor-elements/views/column-empty");ColumnView=BaseElementView.extend({template:Marionette.TemplateCache.get("#tmpl-elementor-column-content"),emptyView:ColumnEmptyView,childViewContainer:"> .elementor-column-wrap > .elementor-widget-wrap",toggleEditTools:!0,behaviors:function(){var e=BaseElementView.prototype.behaviors.apply(this,arguments);return _.extend(e,{Sortable:{behaviorClass:require("elementor-behaviors/sortable"),elChildType:"widget"},Resizable:{behaviorClass:require("elementor-behaviors/resizable")}}),elementor.hooks.applyFilters("elements/column/behaviors",e,this)},className:function(){return BaseElementView.prototype.className.apply(this,arguments)+" elementor-column elementor-"+(this.isInner()?"inner":"top")+"-column"},tagName:function(){return this.model.getSetting("html_tag")||"div"},ui:function(){var e=BaseElementView.prototype.ui.apply(this,arguments);return e.columnInner="> .elementor-column-wrap",e.percentsTooltip="> .elementor-element-overlay .elementor-column-percents-tooltip",e},initialize:function(){BaseElementView.prototype.initialize.apply(this,arguments),this.addControlValidator("_inline_size",this.onEditorInlineSizeInputChange)},getContextMenuGroups:function(){var e=BaseElementView.prototype.getContextMenuGroups.apply(this,arguments),t=e.indexOf(_.findWhere(e,{name:"general"}));return e.splice(t+1,0,{name:"addNew",actions:[{name:"addNew",icon:"eicon-plus",title:elementor.translate("new_column"),callback:this.addNewColumn.bind(this)}]}),e},isDroppingAllowed:function(){var e=elementor.channels.panelElements.request("element:selected");if(!e)return!1;var t=e.model.get("elType");return"section"===t?!this.isInner():"widget"===t},getPercentsForDisplay:function(){return(+this.model.getSetting("_inline_size")||this.getPercentSize()).toFixed(1)+"%"},changeSizeUI:function(){var e=this,t=e.model.getSetting("_column_size");e.$el.attr("data-col",t),_.defer(function(){e.ui.percentsTooltip&&e.ui.percentsTooltip.text(e.getPercentsForDisplay())})},getPercentSize:function(e){return e||(e=this.el.getBoundingClientRect().width),+(e/this.$el.parent().width()*100).toFixed(3)},getSortableOptions:function(){return{connectWith:".elementor-widget-wrap",items:"> .elementor-element"}},changeChildContainerClasses:function(){var e="elementor-element-empty",t="elementor-element-populated";this.collection.isEmpty()?this.ui.columnInner.removeClass(t).addClass(e):this.ui.columnInner.removeClass(e).addClass(t)},addNewColumn:function(){this.trigger("request:add:new")},onCollectionChanged:function(){BaseElementView.prototype.onCollectionChanged.apply(this,arguments),this.changeChildContainerClasses()},onRender:function(){var i=this;BaseElementView.prototype.onRender.apply(i,arguments),i.changeChildContainerClasses(),i.changeSizeUI(),i.$el.html5Droppable({items:" > .elementor-column-wrap > .elementor-widget-wrap > .elementor-element, >.elementor-column-wrap > .elementor-widget-wrap > .elementor-empty-view > .elementor-first-add",axis:["vertical"],groups:["elementor-element"],isDroppingAllowed:i.isDroppingAllowed.bind(i),currentElementClass:"elementor-html5dnd-current-element",placeholderClass:"elementor-sortable-placeholder elementor-widget-placeholder",hasDraggingOnChildClass:"elementor-dragging-on-child",onDropping:function(e,t){t.stopPropagation(),elementor.getPreviewView().onPanelElementDragEnd();var n=jQuery(this).index();"bottom"===e&&n++,i.addElementFromPanel({at:n})}})},onSettingsChanged:function(e){BaseElementView.prototype.onSettingsChanged.apply(this,arguments);var t=e.changedAttributes();("_column_size"in t||"_inline_size"in t)&&this.changeSizeUI()},onEditorInlineSizeInputChange:function(e,t){var n=[],i=this.model.getSetting("_column_size");if(100===i)return n.push("Could not resize one column"),n;t||(t=i);try{this._parent.resizeChild(this,+t,+e)}catch(e){e.message===this._parent.errors.columnWidthTooLarge&&n.push(e.message)}return n},onAddButtonClick:function(e){e.stopPropagation(),this.addNewColumn()}}),module.exports=ColumnView;